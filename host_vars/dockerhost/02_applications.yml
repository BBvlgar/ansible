---

applications:

  skillmatrix_stack:
    skillmatrix-service:
      name: skillmatrix-service
      image: iteconomics/mindmap-service:24
      restartPolicy: always
      environment:
        POSTGRESQL_URL: "{{ skillmatrixservice.POSTGRESQL_URL }}"
        POSTGRESQL_USER: "{{ skillmatrixservice.POSTGRESQL_USER }}"
        POSTGRESQL_PASSWORD: "{{ skillmatrixservice.POSTGRESQL_PASSWORD }}"
        STATIC_CONTENT_PATH: "/usr/share/nginx/html"
      volumes:
        - "/mnt/shared/applications/skillmatrix/html/:/usr/share/nginx/html"
      labels:
        - "traefik.enable: 'true'"
        - "traefik.http.services.skillmatrix-service.loadbalancer.server.port: '8085'"
        - "traefik.http.routers.skillmatrix-service_http.rule: 'Host(`skillmatrix-service.it-economics.de`)'"
        - "traefik.http.routers.skillmatrix-service_http.entrypoints: 'web'"
        - "traefik.http.routers.skillmatrix-service_http.middlewares: 'forcehttps@file'"
        - "traefik.http.routers.skillmatrix-service.rule: 'Host(`skillmatrix-service.it-economics.de`)'"
        - "traefik.http.routers.skillmatrix-service.entrypoints: 'websecure'"
        - "traefik.http.routers.skillmatrix-service.tls: 'true'"
        - "traefik.http.routers.skillmatrix-service.tls.certresolver: 'letsencrypt'"
        - "traefik.http.routers.skillmatrix-service.tls.domains[0].main: 'it-economics.de'"
        - "traefik.http.routers.skillmatrix-service.tls.domains[0].sans: '*.it-economics.de'"
      networks:
        - "backbone"
        - "database"

    skillmatrix-gui:
      name: skillmatrix-gui
      image: iteconomics/d3-skills-mindmap:23
      volumes:
        - "/mnt/shared/applications/skillmatrix/html/:/usr/share/nginx/html"
      restartPolicy: always
      labels:
        - "traefik.enable: 'true'"
        - "traefik.http.services.skillmatrix.loadbalancer.server.port: '8080'"
        - "traefik.http.routers.skillmatrix_http.rule: 'Host(`skillmatrix.it-economics.de`)'"
        - "traefik.http.routers.skillmatrix_http.entrypoints: 'web'"
        - "traefik.http.routers.skillmatrix_http.middlewares: 'forcehttps@file'"
        - "traefik.http.routers.skillmatrix.rule: 'Host(`skillmatrix.it-economics.de`)'"
        - "traefik.http.routers.skillmatrix.entrypoints: 'websecure'"
        - "traefik.http.routers.skillmatrix.tls: 'true'"
        - "traefik.http.routers.skillmatrix.tls.certresolver: 'letsencrypt'"
        - "traefik.http.routers.skillmatrix.tls.domains[0].main: 'it-economics.de'"
        - "traefik.http.routers.skillmatrix.tls.domains[0].sans: '*.it-economics.de'"
      environment:
        VUE_APP_BACKEND_URL: "https://skillmatrix-service.it-economics.de"
      networks:
        - "backbone"
        - "database"

  appstore_stack:
    appstore:
      name: appstore
      image: iteconomics/apache:latest
      restartPolicy: always
      volumes:
        - "/mnt/shared/applications/appstore/web/certs:/certs"
        - "/mnt/shared/applications/appstore/web/config:/etc/apache2/sites-enabled"
        - "/mnt/shared/applications/appstore/data:/var/www/html"
      labels:
        - "traefik.enable: 'true'"
        - "traefik.http.services.appstore.loadbalancer.server.port: '80'"
        - "traefik.http.routers.appstore_http.rule: 'Host(`appstore.it-economics.de`)'"
        - "traefik.http.routers.appstore_http.entrypoints: 'web'"
        - "traefik.http.routers.appstore_http.middlewares: 'forcehttps@file'"
        - "traefik.http.routers.appstore.rule: 'Host(`appstore.it-economics.de`)'"
        - "traefik.http.routers.appstore.entrypoints: 'websecure'"
        - "traefik.http.routers.appstore.tls: 'true'"
        - "traefik.http.routers.appstore.tls.certresolver: 'letsencrypt'"
        - "traefik.http.routers.appstore.tls.domains[0].main: 'it-economics.de'"
        - "traefik.http.routers.appstore.tls.domains[0].sans: '*.it-economics.de'"
      environment:
        MODS: "ssl ldap authnz_ldap php7.0 rewrite headers"
      networks:
        - "backbone"

    appstore_ssh:
      name: appstore_ssh
      image: devopsansiblede/worksuite:latest
      restartPolicy: always
      volumes:
        - "/mnt/shared/applications/appstore/ssh/authorized_keys:/root/.ssh/authorized_keys"
        - "/mnt/shared/applications/appstore/data:/var/www/html"
      labels:
        - "traefik.enable: false"
      ports:
      - "50022:22"
      networks:
        - "backbone"

  atlassian-quote_stack:
    atlassian-quote:
      name: atlassian-quote
      image: iteconomics/atlassian-quote:latest
      restartPolicy: always
      labels:
        - "traefik.enable: 'true'"
        - "traefik.http.services.atlassian-quote.loadbalancer.server.port: '80'"
        - "traefik.http.routers.atlassian-quote_http.rule: 'Host(`atlassian-quote.it-economics.de`)'"
        - "traefik.http.routers.atlassian-quote_http.entrypoints: 'web'"
        - "traefik.http.routers.atlassian-quote_http.middlewares: 'forcehttps@file'"
        - "traefik.http.routers.atlassian-quote.rule: 'Host(`atlassian-quote.it-economics.de`)'"
        - "traefik.http.routers.atlassian-quote.entrypoints: 'websecure'"
        - "traefik.http.routers.atlassian-quote.tls: 'true'"
        - "traefik.http.routers.atlassian-quote.tls.certresolver: 'letsencrypt'"
        - "traefik.http.routers.atlassian-quote.tls.domains[0].main: 'it-economics.de'"
        - "traefik.http.routers.atlassian-quote.tls.domains[0].sans: '*.it-economics.de'"
      environment:
        OpenID_ClientSecret: "{{ atlassianquote.OpenID_ClientSecret }}"
        OpenID_ClientID: "{{ atlassianquote.OpenID_ClientID }}"
        OpenID_MetaDataURL: "{{ atlassianquote.OpenID_MetaDataURL }}"
        OpenID_RedirectURL: "{{ atlassianquote.OpenID_RedirectURL }}"
        OpenID_Mailpost: "{{ atlassianquote.OpenID_Mailpost }}"
        LDAP_Host: "{{ atlassianquote.LDAP_Host }}"
        LDAP_Group: "{{ atlassianquote.LDAP_Group }}"
        LDAP_BindDN: "{{ ldap_directory_user }}"
        LDAP_BindPassword: "{{ ldap_directory_pass }}"
      networks:
        - "backbone"
        - "database"


  crowd_stack:
    crowd:
      name: crowd
      image: iteconomics/crowd:latest
      restartPolicy: always
      volumes:
        - "/mnt/shared/applications/crowd/conf/server.xml:/opt/atlassian/crowd/apache-tomcat/conf/server.xml"
        - "/mnt/shared/applications/crowd/data:/var/atlassian/application-data/crowd"
      labels:
        - "traefik.enable: 'true'"
        - "traefik.http.services.crowd.loadbalancer.server.port: '8095'"
        - "traefik.http.routers.crowd_http.rule: 'Host(`crowd.it-economics.de`)'"
        - "traefik.http.routers.crowd_http.entrypoints: 'web'"
        - "traefik.http.routers.crowd_http.middlewares: 'forcehttps@file'"
        - "traefik.http.routers.crowd.rule: 'Host(`crowd.it-economics.de`)'"
        - "traefik.http.routers.crowd.entrypoints: 'websecure'"
        - "traefik.http.routers.crowd.tls: 'true'"
        - "traefik.http.routers.crowd.tls.certresolver: 'letsencrypt'"
        - "traefik.http.routers.crowd.tls.domains[0].main: 'it-economics.de'"
        - "traefik.http.routers.crowd.tls.domains[0].sans: '*.it-economics.de'"
      networks:
        - "backbone"

  directory-guest_stack:
    directory-guest:
      name: directory-guest
      image: iteconomics/directory:latest
      restartPolicy: always
      volumes:
        - "/mnt/shared/applications/directory-guest/config/.env:/var/www/html/.env"
        - "/mnt/shared/applications/directory-guest/database.sqlite:/var/www/html/database/database.sqlite"
      labels:
        - "traefik.enable: 'true'"
        - "traefik.http.services.directory-guest.loadbalancer.server.port: '80'"
        - "traefik.http.routers.directory-guest_http.rule: 'Host(`directory-guest.it-economics.de`)'"
        - "traefik.http.routers.directory-guest_http.entrypoints: 'web'"
        - "traefik.http.routers.directory-guest_http.middlewares: 'forcehttps@file'"
        - "traefik.http.routers.directory-guest.rule: 'Host(`directory-guest.it-economics.de`)'"
        - "traefik.http.routers.directory-guest.entrypoints: 'websecure'"
        - "traefik.http.routers.directory-guest.tls: 'true'"
        - "traefik.http.routers.directory-guest.tls.certresolver: 'letsencrypt'"
        - "traefik.http.routers.directory-guest.tls.domains[0].main: 'it-economics.de'"
        - "traefik.http.routers.directory-guest.tls.domains[0].sans: '*.it-economics.de'"
      environment:
        MODS: "ssl ldap authnz_ldap php7.0 rewrite headers"
      networks:
        - "backbone"
        - "database"

  directory-test_stack:
    directory-test:
      name: directory-test
      image: iteconomics/directory:testing
      restartPolicy: always
      volumes:
        - "/mnt/shared/applications/certs/data/data:/var/www/html/storage/app/certs"
        - "/mnt/shared/applications/certs/data/templates:/var/www/html/storage/app/templates"
        - "/mnt/shared/applications/directory-test/config/.env:/var/www/html/.env"
        - "/mnt/shared/applications/directory-test/database.sqlite:/var/www/html/database/database.sqlite"
      labels:
        - "traefik.enable: 'true'"
        - "traefik.http.services.directory-test.loadbalancer.server.port: '80'"
        - "traefik.http.routers.directory-test_http.rule: 'Host(`directory-test.it-economics.de`)'"
        - "traefik.http.routers.directory-test_http.entrypoints: 'web'"
        - "traefik.http.routers.directory-test_http.middlewares: 'forcehttps@file'"
        - "traefik.http.routers.directory-test.rule: 'Host(`directory-test.it-economics.de`)'"
        - "traefik.http.routers.directory-test.entrypoints: 'websecure'"
        - "traefik.http.routers.directory-test.tls: 'true'"
        - "traefik.http.routers.directory-test.tls.certresolver: 'letsencrypt'"
        - "traefik.http.routers.directory-test.tls.domains[0].main: 'it-economics.de'"
        - "traefik.http.routers.directory-test.tls.domains[0].sans: '*.it-economics.de'"
      environment:
        MODS: "ssl ldap authnz_ldap php7.0 rewrite headers"
      networks:
        - "backbone"
        - "database"

  directory_stack:
    directory:
      name: directory
      image: iteconomics/directory:latest
      restartPolicy: always
      volumes:
        - "/mnt/shared/applications/directory/config/.env:/var/www/html/.env"
        - "/mnt/shared/applications/directory/database.sqlite:/var/www/html/database/database.sqlite"
        - "/mnt/shared/applications/certs/data/data:/var/www/html/storage/app/certs"
        - "/mnt/shared/applications/certs/data/templates:/var/www/html/storage/app/templates"
        - "/mnt/shared/applications/directory/cronjobs:/etc/cron.d/docker"
      labels:
        - "traefik.enable: 'true'"
        - "traefik.http.services.directory.loadbalancer.server.port: '80'"
        - "traefik.http.routers.directory_http.rule: 'Host(`directory.it-economics.de`)'"
        - "traefik.http.routers.directory_http.entrypoints: 'web'"
        - "traefik.http.routers.directory_http.middlewares: 'forcehttps@file'"
        - "traefik.http.routers.directory.rule: 'Host(`directory.it-economics.de`)'"
        - "traefik.http.routers.directory.entrypoints: 'websecure'"
        - "traefik.http.routers.directory.tls: 'true'"
        - "traefik.http.routers.directory.tls.certresolver: 'letsencrypt'"
        - "traefik.http.routers.directory.tls.domains[0].main: 'it-economics.de'"
        - "traefik.http.routers.directory.tls.domains[0].sans: '*.it-economics.de'"
      environment:
        START_CRON: 1
        MODS: "ssl ldap authnz_ldap php7.0 rewrite headers"
      networks:
        - "backbone"
        - "database"

  teamsurvey-dashboard_stack:
    teamsurvey-dashboard:
      name: teamsurvey-dashboard
      image: iteconomics/teamsurvey-dashboard:latest
      restartPolicy: always
      labels:
        - "traefik.enable: 'true'"
        - "traefik.http.services.teamsurvey-dashboard.loadbalancer.server.port: '80'"
        - "traefik.http.routers.teamsurvey-dashboard_http.rule: 'Host(`teamsurvey.it-economics.de`)'"
        - "traefik.http.routers.teamsurvey-dashboard_http.entrypoints: 'web'"
        - "traefik.http.routers.teamsurvey-dashboard_http.middlewares: 'forcehttps@file'"
        - "traefik.http.routers.teamsurvey-dashboard.rule: 'Host(`teamsurvey.it-economics.de`)'"
        - "traefik.http.routers.teamsurvey-dashboard.entrypoints: 'websecure'"
        - "traefik.http.routers.teamsurvey-dashboard.tls: 'true'"
        - "traefik.http.routers.teamsurvey-dashboard.tls.certresolver: 'letsencrypt'"
        - "traefik.http.routers.teamsurvey-dashboard.tls.domains[0].main: 'it-economics.de'"
        - "traefik.http.routers.teamsurvey-dashboard.tls.domains[0].sans: '*.it-economics.de'"
      environment:
        GRAPHQL_ENDPOINT: "https://teamsurvey-api.it-economics.de/graphql"
      networks:
        - "backbone"

  teamsurvey-dashboard-testing_stack:
    teamsurvey-dashboard-testing:
      name: teamsurvey-dashboard-testing
      image: iteconomics/teamsurvey-dashboard:testing
      restartPolicy: always
      labels:
        - "traefik.enable: 'true'"
        - "traefik.http.services.teamsurvey-dashboard-testing.loadbalancer.server.port: '80'"
        - "traefik.http.routers.teamsurvey-dashboard-testing_http.rule: 'Host(`teamsurvey-test.it-economics.de`)'"
        - "traefik.http.routers.teamsurvey-dashboard-testing_http.entrypoints: 'web'"
        - "traefik.http.routers.teamsurvey-dashboard-testing_http.middlewares: 'forcehttps@file'"
        - "traefik.http.routers.teamsurvey-dashboard-testing.rule: 'Host(`teamsurvey-test.it-economics.de`)'"
        - "traefik.http.routers.teamsurvey-dashboard-testing.entrypoints: 'websecure'"
        - "traefik.http.routers.teamsurvey-dashboard-testing.tls: 'true'"
        - "traefik.http.routers.teamsurvey-dashboard-testing.tls.certresolver: 'letsencrypt'"
        - "traefik.http.routers.teamsurvey-dashboard-testing.tls.domains[0].main: 'it-economics.de'"
        - "traefik.http.routers.teamsurvey-dashboard-testing.tls.domains[0].sans: '*.it-economics.de'"
      environment:
        GRAPHQL_ENDPOINT: "https://teamsurvey-api-testing.it-economics.de/graphql"
      networks:
        - "backbone"

  vcard_stack:
    vcard:
      name: vcard
      image: iteconomics/apache:latest
      restartPolicy: always
      volumes:
        - /mnt/shared/applications/vcard/web/proxy.conf:/etc/apache2/sites-enabled/000-default.conf:ro
      labels:
        - "traefik.enable: 'true'"
        - "traefik.http.services.vcard.loadbalancer.server.port: '80'"
        - "traefik.http.routers.vcard_http.rule: 'Host(`vcard.it-economics.de`)'"
        - "traefik.http.routers.vcard_http.entrypoints: 'web'"
        - "traefik.http.routers.vcard_http.middlewares: 'forcehttps@file'"
        - "traefik.http.routers.vcard.rule: 'Host(`vcard.it-economics.de`)'"
        - "traefik.http.routers.vcard.entrypoints: 'websecure'"
        - "traefik.http.routers.vcard.tls: 'true'"
        - "traefik.http.routers.vcard.tls.certresolver: 'letsencrypt'"
        - "traefik.http.routers.vcard.tls.domains[0].main: 'it-economics.de'"
        - "traefik.http.routers.vcard.tls.domains[0].sans: '*.it-economics.de'"
      environment:
        MODS: "proxy proxy_http auth_basic authnz_ldap authz_core rewrite headers"
      networks:
        - "backbone"

    vcardserver:
      name: vcardserver
      image: tomsquest/docker-radicale:latest
      restartPolicy: always
      volumes:
        - "/mnt/shared/applications/vcard/docker-entrypoint.sh:/usr/local/bin/docker-entrypoint.sh"
        - "/mnt/shared/applications/vcard/config:/config"
        - "/mnt/shared/applications/vcard/data:/data"
      labels:
        - "traefik.enable: false"
      networks:
        - "backbone"

    vcardsync:
      name: vcardsync
      image: iteconomics/contactsync_ldap_exporter:latest
      restartPolicy: always
      volumes:
        - "/mnt/shared/applications/vcard/data:/data"
      labels:
        - "traefik.enable: false"
      environment:
        ITE_CONTACT_DIR: '/data/collections/collection-root/'
        ITE.EXPORTCONTACTDIR: '/data/collections/collection-root/'
        LDAP_PASSWORD: "{{ ldap_directory_pass }}"
        LDAP_URL: "{{ ldap_url }}"
        LDAP_USERNAME: "{{ ldap_directory_user }}"
        network_mode: proxy

  surveyappproxy_stack:
    surveyappproxy:
      name: surveyappproxy
      image: nginx:latest
      restartPolicy: always
      volumes:
        - "/mnt/shared/applications/teamsurveyrest.it-economics.de/nginx.conf:/etc/nginx/nginx.conf"
      labels:
        - "traefik.enable: 'true'"
        - "traefik.http.services.teamsurveyrest.loadbalancer.server.port: '80'"
        - "traefik.http.routers.teamsurveyrest_http.rule: 'Host(`teamsurveyrest.it-economics.de`)'"
        - "traefik.http.routers.teamsurveyrest_http.entrypoints: 'web'"
        - "traefik.http.routers.teamsurveyrest_http.middlewares: 'forcehttps@file'"
        - "traefik.http.routers.teamsurveyrest.rule: 'Host(`teamsurveyrest.it-economics.de`)'"
        - "traefik.http.routers.teamsurveyrest.entrypoints: 'websecure'"
        - "traefik.http.routers.teamsurveyrest.tls: 'true'"
        - "traefik.http.routers.teamsurveyrest.tls.certresolver: 'letsencrypt'"
        - "traefik.http.routers.teamsurveyrest.tls.domains[0].main: 'it-economics.de'"
        - "traefik.http.routers.teamsurveyrest.tls.domains[0].sans: '*.it-economics.de'"
      environment:
        MODS: "ssl ldap authnz_ldap php7.0 rewrite headers"
      networks:
        - "backbone"

  share_stack:
    share:
      name: share
      image: nextcloud:latest
      restartPolicy: always
      volumes:
        - "/mnt/shared/applications/share/data/apps:/var/www/html/apps"
        - "/mnt/shared/applications/share/data/config:/var/www/html/config"
        - "/mnt/shared/applications/share/data/data:/var/www/html/data"
      labels:
        - "traefik.enable: 'true'"
        - "traefik.http.services.share.loadbalancer.server.port: '80'"
        - "traefik.http.routers.share_http.rule: 'Host(`share.it-economics.de`)'"
        - "traefik.http.routers.share_http.entrypoints: 'web'"
        - "traefik.http.routers.share_http.middlewares: 'forcehttps@file'"
        - "traefik.http.routers.share.rule: 'Host(`share.it-economics.de`)'"
        - "traefik.http.routers.share.entrypoints: 'websecure'"
        - "traefik.http.routers.share.tls: 'true'"
        - "traefik.http.routers.share.tls.certresolver: 'letsencrypt'"
        - "traefik.http.routers.share.tls.domains[0].main: 'it-economics.de'"
        - "traefik.http.routers.share.tls.domains[0].sans: '*.it-economics.de'"
      networks:
        - "backbone"
        - "database"


  share-secrets_stack:
    share-secrets:
      name: share-secrets
      image: iteconomics/apache:latest
      restartPolicy: always
      volumes:
        - "/mnt/shared/applications/share-secrets/apache/apache.j2:/templates/apache.j2"
        - "/mnt/shared/applications/share-secrets/html:/var/www/html/public"
      labels:
        - "traefik.enable: 'true'"
        - "traefik.http.services.secrets.loadbalancer.server.port: '80'"
        - "traefik.http.routers.secrets_http.rule: 'Host(`secrets.it-economics.de`)'"
        - "traefik.http.routers.secrets_http.entrypoints: 'web'"
        - "traefik.http.routers.secrets_http.middlewares: 'forcehttps@file'"
        - "traefik.http.routers.secrets.rule: 'Host(`secrets.it-economics.de`)'"
        - "traefik.http.routers.secrets.entrypoints: 'websecure'"
        - "traefik.http.routers.secrets.tls: 'true'"
        - "traefik.http.routers.secrets.tls.certresolver: 'letsencrypt'"
        - "traefik.http.routers.secrets.tls.domains[0].main: 'it-economics.de'"
        - "traefik.http.routers.secrets.tls.domains[0].sans: '*.it-economics.de'"
      networks:
        - "backbone"
      environment:
        APACHE_PUBLIC_DIR: '/var/www/html/public'

  roominfo-service_stack:
    roominfo-service:
      name: roominfo-service
      image: iteconomics/icsviewer:latest
      restartPolicy: always
      volumes:
        - "/mnt/shared/applications/roominfo-service/config/.env:/var/www/html/.env"
      labels:
        - "traefik.enable: 'true'"
        - "traefik.http.services.roominfo-service.loadbalancer.server.port: '80'"
        - "traefik.http.routers.roominfo-service_http.rule: 'Host(`roominfo-service.it-economics.de`)'"
        - "traefik.http.routers.roominfo-service_http.entrypoints: 'web'"
        - "traefik.http.routers.roominfo-service_http.middlewares: 'forcehttps@file'"
        - "traefik.http.routers.roominfo-service.rule: 'Host(`roominfo-service.it-economics.de`)'"
        - "traefik.http.routers.roominfo-service.entrypoints: 'websecure'"
        - "traefik.http.routers.roominfo-service.tls: 'true'"
        - "traefik.http.routers.roominfo-service.tls.certresolver: 'letsencrypt'"
        - "traefik.http.routers.roominfo-service.tls.domains[0].main: 'it-economics.de'"
        - "traefik.http.routers.roominfo-service.tls.domains[0].sans: '*.it-economics.de'"
      networks:
        - "backbone"

  portainer_stack:
    portainer:
      name: portainer
      image: portainer/portainer-ce
      restartPolicy: always
      volumes:
            - '/var/run/docker.sock:/var/run/docker.sock'
            - '/mnt/shared/applications/portainer/data:/data'
      labels:
        - "traefik.enable: 'true'"
        - "traefik.http.services.portainer.loadbalancer.server.port: '9000'"
        - "traefik.http.routers.portainer_http.rule: 'Host(`portainer.it-economics.de`)'"
        - "traefik.http.routers.portainer_http.entrypoints: 'web'"
        - "traefik.http.routers.portainer_http.middlewares: 'forcehttps@file'"
        - "traefik.http.routers.portainer.rule: 'Host(`portainer.it-economics.de`)'"
        - "traefik.http.routers.portainer.entrypoints: 'websecure'"
        - "traefik.http.routers.portainer.tls: 'true'"
        - "traefik.http.routers.portainer.tls.certresolver: 'letsencrypt'"
        - "traefik.http.routers.portainer.tls.domains[0].main: 'it-economics.de'"
        - "traefik.http.routers.portainer.tls.domains[0].sans: '*.it-economics.de'"
      networks:
        - "backbone"
      ports:
        - "9000:9000"
        - "8000:8000"

  phonestat_stack:
    phonestat:
      name: phonestat
      image: iteconomics/apache:latest
      restartPolicy: always
      volumes:
        - "/mnt/shared/applications/phonestat/telefonstatus:/var/www/html"
      labels:
        - "traefik.enable: 'true'"
        - "traefik.http.services.phonestat.loadbalancer.server.port: '80'"
        - "traefik.http.routers.phonestat_http.rule: 'Host(`phonestat.it-economics.de`)'"
        - "traefik.http.routers.phonestat_http.entrypoints: 'web'"
        - "traefik.http.routers.phonestat_http.middlewares: 'forcehttps@file'"
        - "traefik.http.routers.phonestat.rule: 'Host(`phonestat.it-economics.de`)'"
        - "traefik.http.routers.phonestat.entrypoints: 'websecure'"
        - "traefik.http.routers.phonestat.tls: 'true'"
        - "traefik.http.routers.phonestat.tls.certresolver: 'letsencrypt'"
        - "traefik.http.routers.phonestat.tls.domains[0].main: 'it-economics.de'"
        - "traefik.http.routers.phonestat.tls.domains[0].sans: '*.it-economics.de'"
      networks:
        - "backbone"
      environment:
        APACHE_PUBLIC_DIR: /var/www/html/public

  passcard_stack:
    passcard:
      name: passcard
      image: iteconomics/passcard:latest
      restartPolicy: always
      volumes:
        - "/mnt/shared/applications/passcard/data:/var/www/html/storage"
      labels:
        - "traefik.enable: 'true'"
        - "traefik.http.services.passcard.loadbalancer.server.port: '80'"
        - "traefik.http.routers.passcard_http.rule: 'Host(`passcard.it-economics.de`)'"
        - "traefik.http.routers.passcard_http.entrypoints: 'web'"
        - "traefik.http.routers.passcard_http.middlewares: 'forcehttps@file'"
        - "traefik.http.routers.passcard.rule: 'Host(`passcard.it-economics.de`)'"
        - "traefik.http.routers.passcard.entrypoints: 'websecure'"
        - "traefik.http.routers.passcard.tls: 'true'"
        - "traefik.http.routers.passcard.tls.certresolver: 'letsencrypt'"
        - "traefik.http.routers.passcard.tls.domains[0].main: 'it-economics.de'"
        - "traefik.http.routers.passcard.tls.domains[0].sans: '*.it-economics.de'"
      networks:
        - "backbone"

  memorysourceexport_stack:
    memorysourceexport:
      name: memorysourceexport
      image: iteconomics/memorysourceexport:latest
      restartPolicy: always
      labels:
        - "traefik.enable: 'true'"
        - "traefik.http.services.memory.loadbalancer.server.port: '80'"
        - "traefik.http.routers.memory_http.rule: 'Host(`memory.it-economics.de`)'"
        - "traefik.http.routers.memory_http.entrypoints: 'web'"
        - "traefik.http.routers.memory_http.middlewares: 'forcehttps@file'"
        - "traefik.http.routers.memory.rule: 'Host(`memory.it-economics.de`)'"
        - "traefik.http.routers.memory.entrypoints: 'websecure'"
        - "traefik.http.routers.memory.tls: 'true'"
        - "traefik.http.routers.memory.tls.certresolver: 'letsencrypt'"
        - "traefik.http.routers.memory.tls.domains[0].main: 'it-economics.de'"
        - "traefik.http.routers.memory.tls.domains[0].sans: '*.it-economics.de'"
      environment:
        LDAP_BindDN: "{{ ldap_directory_user }}"
        AUTH_USERS_JSON: "{{ memorysourceexport.AUTH_USERS_JSON }}"
        LDAP_Host: "{{ ldap_url }}"
        LDAP_BASE_DN: "{{ ldap_base_dn }}"
        LDAP_BindPassword: "{{ ldap_directory_pass }}"
      networks:
        - "backbone"

  memorysourceexport-testing_stack:
    memorysourceexport-testing:
      name: memorysourceexport-testing
      image: iteconomics/memorysourceexport:testing
      restartPolicy: always
      labels:
        - "traefik.enable: 'true'"
        - "traefik.http.services.memory.loadbalancer-test.server.port: '80'"
        - "traefik.http.routers.memory_http-test.rule: 'Host(`memory-testing.it-economics.de`)'"
        - "traefik.http.routers.memory_http-test.entrypoints: 'web'"
        - "traefik.http.routers.memory_http-test.middlewares: 'forcehttps@file'"
        - "traefik.http.routers.memory-test.rule: 'Host(`memory-testing.it-economics.de`)'"
        - "traefik.http.routers.memory-test.entrypoints: 'websecure'"
        - "traefik.http.routers.memory-test.tls: 'true'"
        - "traefik.http.routers.memory-test.tls.certresolver: 'letsencrypt'"
        - "traefik.http.routers.memory-test.tls.domains[0].main: 'it-economics.de'"
        - "traefik.http.routers.memory-test.tls.domains[0].sans: '*.it-economics.de'"
      environment:
        LDAP_BindDN: "{{ ldap_directory_user }}"
        AUTH_USERS_JSON: "{{ memorysourceexport.AUTH_USERS_JSON }}"
        LDAP_Host: "{{ ldap_url }}"
        LDAP_BASE_DN: "{{ ldap_base_dn }}"
        LDAP_BindPassword: "{{ ldap_directory_pass }}"
      networks:
        - "backbone"

  ldap01_stack:
    ldap01:
      name: ldap01
      image: iteconomics/openldap:latest
      restartPolicy: always
      volumes:
        - "/mnt/shared/applications/ldap01/data/certs:/certs"
        - "/mnt/shared/applications/ldap01/data/config:/etc/ldap/slapd.d"
        - "/mnt/shared/applications/ldap01/data/import:/import"
        - "/mnt/shared/applications/ldap01/data/data:/var/lib/ldap"
      labels:
        - "traefik.enable: false"
      ports:
        - "20636:636"
      networks:
        - "database"

  ldap-guest_stack:
    ldap-guest:
      name: ldap-guest
      image: iteconomics/openldap:latest
      restartPolicy: always
      volumes:
        - "/mnt/shared/applications/ldap-guest/data/certs:/certs"
        - "/mnt/shared/applications/ldap-guest/data/config:/etc/ldap/slapd.d"
        - "/mnt/shared/applications/ldap-guest/data/import:/import"
        - "/mnt/shared/applications/ldap-guest/data/data:/var/lib/ldap"
      labels:
        - "traefik.enable: false"
      ports:
        - "636:636"
      networks:
        - "database"

  ldap-test_stack:
    ldap-test:
      name: ldap-test
      image: iteconomics/openldap:testing
      restartPolicy: always
      volumes:
        - "/mnt/shared/applications/ldap-test/data/certs:/certs"
        - "/mnt/shared/applications/ldap-test/data/config:/etc/ldap/slapd.d"
        - "/mnt/shared/applications/ldap-test/data/import:/import"
        - "/mnt/shared/applications/ldap-test/data/data:/var/lib/ldap"
      labels:
        - "traefik.enable: false"
      ports:
       - "40636:636"
      networks:
        - "database"

  ldap-certs_stack:
    ldap-certs:
      name: ldap-certs
      image: iteconomics/openldap:latest
      restartPolicy: always
      volumes:
        - "/mnt/shared/applications/ldap-certs/data/certs:/certs"
        - "/mnt/shared/applications/ldap-certs/data/config:/etc/ldap/slapd.d"
        - "/mnt/shared/applications/ldap-certs/data/import:/import"
        - "/mnt/shared/applications/ldap-certs/data/data:/var/lib/ldap"
      labels:
        - "traefik.enable: false"
      ports:
        - "60636:636"
      networks:
        - "database"

  kdc01_stack:
    kdc01:
      name: kdc01
      image:  docker.io/iteconomics/kdc:latest
      restartPolicy: always
      volumes:
        - "/dev/urandom:/dev/urandom"
        - "/mnt/shared/applications/kdc01/config:/kdc"
      labels:
        - "traefik.enable: false"
      ports:
        - "464:464/tcp"
        - "464:464/udp"
        - "749:749/tcp"
        - "749:749/udp"
        - "88:88/tcp"
        - "88:88/udp"
      networks:
        - "database"

  limesurvey_stack:
    limesurvey:
      name: limesurvey
      image:  iteconomics/limesurvey:latest
      restartPolicy: always
      volumes:
        - "/mnt/shared/applications/survey/data/admin_theme:/var/www/html/upload/admintheme/iteconomics"
        - "/mnt/shared/applications/survey/data/template:/var/www/html/upload/themes/survey/iteconomics"
      labels:
        - "traefik.enable: 'true'"
        - "traefik.http.services.survey.loadbalancer.server.port: '80'"
        - "traefik.http.routers.survey_http.rule: 'Host(`survey.it-economics.de`)'"
        - "traefik.http.routers.survey_http.entrypoints: 'web'"
        - "traefik.http.routers.survey_http.middlewares: 'forcehttps@file'"
        - "traefik.http.routers.survey.rule: 'Host(`survey.it-economics.de`)'"
        - "traefik.http.routers.survey.entrypoints: 'websecure'"
        - "traefik.http.routers.survey.tls: 'true'"
        - "traefik.http.routers.survey.tls.certresolver: 'letsencrypt'"
        - "traefik.http.routers.survey.tls.domains[0].main: 'it-economics.de'"
        - "traefik.http.routers.survey.tls.domains[0].sans: '*.it-economics.de'"
      environment:
        DB_HOST: "{{ limesurvey.DB_HOST }}"
        DB_NAME: "{{ limesurvey.DB_NAME }}"
        DB_USER: "{{ limesurvey.DB_USER }}"
        DB_PASS: "{{ limesurvey.DB_PASS }}"
        LIMESURVEY_TITLE: "{{ limesurvey.LIMESURVEY_TITLE }}"
        LIMESURVEY_ADMIN: "{{ limesurvey.LIMESURVEY_ADMIN }}"
        LIMESURVEY_ADMIN_PASS: "{{ limesurvey.LIMESURVEY_ADMIN_PASS }}"
        LIMESURVEY_ADMIN_NAME: "{{ limesurvey.LIMESURVEY_ADMIN_NAME }}"
        LIMESURVEY_ADMIN_MAIL: "{{ limesurvey.LIMESURVEY_ADMIN_MAIL }}"
        LIMESURVEY_DEFAULT_LANG: "{{ limesurvey.LIMESURVEY_DEFAULT_LANG }}"
        LIMESURVEY_SHOW_SCRIPT_NAME: "{{ limesurvey.LIMESURVEY_SHOW_SCRIPT_NAME }}"
        LDAP_SERVER: "{{ limesurvey.LDAP_SERVER }}"
        LDAP_PORT: "{{ limesurvey.LDAP_PORT }}"
        LDAP_TLS: "{{ limesurvey.LDAP_TLS }}"
        LDAP_ALLOW_CREATION_TO_LOGGEDIN: "{{ limesurvey.LDAP_ALLOW_CREATION_TO_LOGGEDIN }}"
        LDAP_GROUP_NAME: "{{ limesurvey.LDAP_GROUP_NAME }}"
        LDAP_USER_PREFIX: "{{ limesurvey.LDAP_USER_PREFIX }}"
        LDAP_USER_SUFFIX: "{{ limesurvey.LDAP_USER_SUFFIX }}"
        LDAP_USER_SEARCH_BASE: "{{ limesurvey.LDAP_USER_SEARCH_BASE }}"
        LDAP_GROUP_SEARCH_BASE: "{{ limesurvey.LDAP_GROUP_SEARCH_BASE }}"
        LDAP_BIND_DN: "{{ limesurvey.LDAP_BIND_DN }}"
        LDAP_BIND_PASS: "{{ limesurvey.LDAP_BIND_PASS }}"
        LIMESURVEY_DEBUG: "{{ limesurvey.LIMESURVEY_DEBUG }}"
        ADMIN_THEME_NAME: "{{ limesurvey.ADMIN_THEME_NAME }}"
        DEFAULT_TEMPLATE: "{{ limesurvey.DEFAULT_TEMPLATE }}"
      networks:
        - "backbone"

...
